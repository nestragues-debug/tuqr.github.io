<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TuQR â€” Datos para transferir</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-D9TN01T1R0"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config','G-D9TN01T1R0');
</script>

<style>
body{font-family:system-ui;margin:0;padding:24px;background:#fff}
.card{max-width:520px;margin:auto;border:1px solid #eee;border-radius:16px;padding:18px}
h1{font-size:22px;margin:0 0 8px}
p{margin:0 0 14px;color:#444}

pre{
background:#f6f6f6;
padding:14px;
border-radius:12px;
white-space:pre-wrap;
font-size:15px;
}

button{
width:100%;
padding:16px;
font-size:18px;
border:0;
border-radius:12px;
cursor:pointer;
background:#0078ff;
color:#fff;
font-weight:600;
}

.ok{margin-top:10px;color:#0a7;font-weight:700;display:none}
.err{margin-top:10px;color:#b00;font-weight:700;display:none}

.fields{margin-top:18px;border-top:1px solid #eee;padding-top:14px}
.field{margin-bottom:12px}
.lbl{font-size:12px;color:#555;margin-bottom:6px;display:block}

.row{
display:grid;
grid-template-columns:1fr auto;
gap:10px;
align-items:center;
}

input{
width:100%;
padding:10px 12px;
border-radius:10px;
border:1px solid #e6e6e6;
background:#f6f6f6;
font-size:14px;
}

.small{margin-top:12px;font-size:12px;color:#777}
</style>
</head>

<body>
<div class="card">

<h1 id="title">Paga con transferencia</h1>
<p>Copia y pega estos datos en tu aplicaciÃ³n bancaria 22:03.</p>

<pre id="visual">Cargandoâ€¦</pre>

<!-- textarea oculto para copiado seguro -->
<textarea id="hiddenCopy" style="position:absolute;left:-9999px;top:-9999px"></textarea>

<button id="copyAll">ðŸ“‹ Copiar datos para transferir</button>

<div id="ok" class="ok">Copiado âœ…</div>
<div id="err" class="err">No encontramos este cobrador</div>

<!-- copiar campo por campo -->
<div id="fields" class="fields" style="display:none">

<div class="field">
<label class="lbl">Nombre</label>
<div class="row">
<input id="i_nombre" readonly>
<button id="c_nombre">Copiar</button>
</div>
</div>

<div class="field">
<label class="lbl">Rut</label>
<div class="row">
<input id="i_rut" readonly>
<button id="c_rut">Copiar</button>
</div>
</div>

<div class="field">
<label class="lbl">Banco</label>
<div class="row">
<input id="i_banco" readonly>
<button id="c_banco">Copiar</button>
</div>
</div>

<div class="field">
<label class="lbl">Tipo</label>
<div class="row">
<input id="i_tipo" readonly>
<button id="c_tipo">Copiar</button>
</div>
</div>

<div class="field">
<label class="lbl">NÃºmero Cuenta</label>
<div class="row">
<input id="i_numero" readonly>
<button id="c_numero">Copiar</button>
</div>
</div>

<div class="field" id="correoRow">
<label class="lbl">Correo</label>
<div class="row">
<input id="i_correo" readonly>
<button id="c_correo">Copiar</button>
</div>
</div>

</div>

<div class="small">
En TuQR solo copias los datos. <b>La transferencia se hace desde tu banco.</b>
</div>

</div>

<script>
const id=new URLSearchParams(location.search).get('id')?.trim();

const visual=document.getElementById('visual');
const hidden=document.getElementById('hiddenCopy');
const ok=document.getElementById('ok');
const err=document.getElementById('err');
const fields=document.getElementById('fields');

function clean(s){
return String(s??'')
.normalize('NFC')
.replace(/\u00A0/g,' ')
.replace(/[\u200B-\u200D\uFEFF]/g,'')
.replace(/\r\n/g,'\n')
.trim();
}

function showOk(){
ok.style.display='block';
setTimeout(()=>ok.style.display='none',1200);
}

async function copy(text){
hidden.value=text;
hidden.focus();
hidden.select();
hidden.setSelectionRange(0,text.length);

try{
await navigator.clipboard.writeText(text);
}catch{
document.execCommand('copy');
}
showOk();
}

function buildText(d){
let t=
`Nombre: ${d.nombre}
Rut: ${d.rut}
Banco: ${d.banco}
Tipo: ${d.tipoCuenta}
NÃºmero Cuenta: ${d.numeroCuenta}`;
if(d.correo) t+=`\nCorreo: ${d.correo}`;
return t;
}

fetch('./data.json',{cache:'no-store'})
.then(r=>r.json())
.then(all=>{
const d=all[id];
if(!d){err.style.display='block';return;}

d.nombre=clean(d.nombre);
d.rut=clean(d.rut);
d.banco=clean(d.banco);
d.tipoCuenta=clean(d.tipoCuenta);
d.numeroCuenta=clean(d.numeroCuenta);
d.correo=clean(d.correo);

document.getElementById('title').textContent=`Paga a ${d.nombre}`;

const text=buildText(d);
visual.textContent=text;

fields.style.display='block';

i_nombre.value=d.nombre;
i_rut.value=d.rut;
i_banco.value=d.banco;
i_tipo.value=d.tipoCuenta;
i_numero.value=d.numeroCuenta;
i_correo.value=d.correo;

if(!d.correo) correoRow.style.display='none';

copyAll.onclick=()=>copy(text);
c_nombre.onclick=()=>copy(d.nombre);
c_rut.onclick=()=>copy(d.rut);
c_banco.onclick=()=>copy(d.banco);
c_tipo.onclick=()=>copy(d.tipoCuenta);
c_numero.onclick=()=>copy(d.numeroCuenta);
c_correo.onclick=()=>copy(d.correo);

gtag('event','payer_page_view',{merchant_id:id});
});
</script>

</body>
</html>
